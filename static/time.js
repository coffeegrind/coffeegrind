var project = {"dateCreated":"2016-03-27T14:34:36.351Z","dateModified":"2016-03-28T15:58:59.877Z","name":"hello sir","id":"hello sir","timeBits":[{"s":1459089277406,"e":1459089278813},{"s":1459089322381,"e":1459089323699},{"s":1459089325130,"e":1459089329156},{"s":1459089333131,"e":1459089334308},{"s":1459089338596,"e":1459089352935},{"s":1459089353903,"e":1459089381962},{"s":1459089389033,"e":1459089424845},{"s":1459089566403,"e":1459089588104},{"s":1459089599709,"e":1459089641564},{"s":1459089651658,"e":1459089652691},{"s":1459089653880,"e":1459089657582},{"s":1459089683094,"e":1459089686886},{"s":1459089814509,"e":1459089819034},{"s":1459089820057,"e":1459089820219},{"s":1459089898818,"e":1459089899704},{"s":1459089952173,"e":1459089956692},{"s":1459089970825,"e":1459089971755},{"s":1459090053169,"e":1459090054037},{"s":1459090055618,"e":1459090057389},{"s":1459090075593,"e":1459090080789},{"s":1459090349148,"e":1459090351261},{"s":1459090351825,"e":1459090360317},{"s":1459091056316,"e":1459091058913},{"s":1459091059175,"e":1459091060685},{"s":1459091060947,"e":1459091272267},{"s":1459091308139,"e":1459091313793},{"s":1459091317346,"e":1459091320181},{"s":1459092111154,"e":1459092117710},{"s":1459092128314,"e":1459092133131},{"s":1459092257737,"e":1459092263292},{"s":1459092356773,"e":1459092358742},{"s":1459092470288,"e":1459092471326},{"s":1459092479777,"e":1459092483557},{"s":1459092503495,"e":1459092507120},{"s":1459092555444,"e":1459092561288},{"s":1459092696893,"e":1459092702661},{"s":1459092706100,"e":1459092708560},{"s":1459092711231,"e":1459092715936},{"s":1459092721663,"e":1459092724934},{"s":1459092727188,"e":1459092729958},{"s":1459092749080,"e":1459092757395},{"s":1459092771369,"e":1459092796309},{"s":1459092798359,"e":1459092800299},{"s":1459092805512,"e":1459092810631},{"s":1459092813902,"e":1459092815949},{"s":1459092830884,"e":1459092833948},{"s":1459092837017,"e":1459092840701},{"s":1459092841726,"e":1459092847665},{"s":1459092848076,"e":1459092879582},{"s":1459092880606,"e":1459092918979},{"s":1459092920221,"e":1459092922674},{"s":1459092925331,"e":1459092946124},{"s":1459092950420,"e":1459092954927},{"s":1459092963737,"e":1459092986037},{"s":1459092990132,"e":1459092998521},{"s":1459092999955,"e":1459093008541},{"s":1459093015091,"e":1459093025330},{"s":1459093026558,"e":1459093029010},{"s":1459093035355,"e":1459093037609},{"s":1459093038225,"e":1459093040758},{"s":1459093041985,"e":1459093043417},{"s":1459093046275,"e":1459093048733},{"s":1459093681118,"e":1459093684033},{"s":1459093684118,"e":1459093684725},{"s":1459093713111,"e":1459093749850},{"s":1459093758229,"e":1459093783788},{"s":1459093791773,"e":1459093795859},{"s":1459093973102,"e":1459093975565},{"s":1459093977414,"e":1459093980073},{"s":1459093981917,"e":1459093982149},{"s":1459093987437,"e":1459093989124},{"s":1459094191363,"e":1459094193600},{"s":1459094195859,"e":1459094200155},{"s":1459094202606,"e":1459094203478},{"s":1459094211810,"e":1459094214052},{"s":1459094215690,"e":1459094216810},{"s":1459096643013,"e":1459096646826},{"s":1459099670008,"e":1459099670785},{"s":1459099673025,"e":1459099673488},{"s":1459099675897,"e":1459099676257},{"s":1459129034466,"e":1459129035111},{"s":1459129035695,"e":1459129036039},{"s":1459129036440,"e":1459129036799},{"s":1459129037336,"e":1459129037791},{"s":1459129038336,"e":1459129038703},{"s":1459129039240,"e":1459129039575},{"s":1459178304881,"e":1459178315554},{"s":1459180253413,"e":1459180262675},{"s":1459180269578,"e":1459180330284},{"s":1459180384349,"e":1459180402435},{"s":1459180577182,"e":1459180638709},{"s":1459180642735,"e":1459180644819},{"s":1459180729268,"e":1459180734625},{"s":1459180736653,"e":1459180739877},{"s":1459180739879,"e":1459272341353}, {"s":1459272341354,"e":1459272360818}],"directory":"/Users/Nick/dev/haileydev"};

/**
 * Given an array of time ranges (in ms), folds them into windows of window_ms.
 */
function fold_time_ranges(ranges, window_ms) {
  return ranges.reduce(function(memo, curr) {
    var prev = memo[memo.length - 1];
    if (!prev || curr.e - prev[0].s >= window_ms) {
      // split the overlap
      if (prev && prev[0].s + window_ms - curr.s > 0) {
        prev.push({s: curr.s, e: prev[0].s + window_ms});
        memo.push([{s: prev[0].s + window_ms, e: curr.e}]);
      }
      else {
        memo.push([curr]);  
      }
    }
    else {
      // take the whole time range
      prev.push(curr);
    }
    
    return memo;
  }, []);
}

/*fold_time_ranges(project.timeBits, 86400 * 1000).forEach(function(e) {
  e.forEach(function(r) {
    console.log(r.e - r.s);
  });
});*/

// total time elapsed per window (in ms)
res = fold_time_ranges(project.timeBits, 86400 * 1000).map(function(e) {
  return e.reduce(function(memo, curr) {
    return (curr.e - curr.s) + memo;
  }, 0);
});

function humanTime(ms) {
  var x = ms / 1000;
  var seconds = x % 60;
  x /= 60;
  var minutes = x % 60;
  x /= 60;
  var hours = x % 24;
  x /= 24;
  var days = x;
  
  return (days >= 1 ? Math.floor(days) + " days " : '') +
         (hours >= 1 ? Math.floor(hours) + " hours " : '') +
         (minutes >= 1 ? Math.floor(minutes) + " minutes " : '') +
         (seconds >= 1 ? Math.floor(seconds) + " seconds" : '');
}